<?xml version="1.0" encoding="UTF-8"?>
<cherrytree>
  <node name="Grep" unique_id="16" prog_lang="custom-colors" tags="" readonly="0" nosearch_me="0" nosearch_ch="0" custom_icon_id="0" is_bold="0" foreground="" ts_creation="1692799352" ts_lastsave="1692808650">
    <rich_text>nmap -sC -sV -vv -Pn -n 10.10.203.137

PORT     STATE    SERVICE       REASON      VERSION
22/tcp   open     ssh           syn-ack     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 65d065ddd8309ab85ded6a2a76a4df5c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCnViIjk7VrHcXeVdT09ZfBS6YhqAXKaAfKCBVMNXHSvK26WlBrQZIXUsY+bMRa6ruhmzztuqUgORco7YaGJMKgNGc3jxWgWKP3LAvNvFvrDZPYIjAMn+X7Hq9uXoXff8cxf2tJnAtyJ36V7iU4G8KG5yARRb3gqe97cSrX8b7fw+R7N/LozECzvQfZgbnuC3jRY0R9O069POX8VVndxPxZqKchbxU5Nc9hKjhLjRBgKuNWjstRhEWOMkAnbOIokBKM9Ki8EfPM6+MY/P0zLP3Ff7GcloEm+gpEwVnVtOqJDNFwgNMFJIFkRLtqp1YHE5uJcONhiVhcnGBVy9PMTIV1iFMNt/SyHAbw4IZ9/d4/AnSowlOsmVwtjNXAEl8EXYORIMSV4qVIRQ4h4yYvQnSdAIjkyfMbO83qE34Syq1+JnsfWe1Ox/wosAA06I/RpTDj+nACHZKc9cZkL9ex7ioaL8q4fANU9Eozth4vUwqYMk4jEKCGQ7VtNRe3Vk9YnVU=
|   256 db8206a26e67c5675ba8fd480ac0e733 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBGRSQWxQxHfvGnsBPaju9178uB/+F0/IOwo+2j+XRRJg9WI5Tlvlod9iQz6DPcicJqYTU77ldNQJeUNIoC7OSdg=
|   256 9746224b6a0a0ed49746cdcda9e6395d (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKFnJEPBtuifLJZOXa+gJ0TaPM3mloaqT1m3Q+GnJtxD



80/tcp   open     http          syn-ack     Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS


443/tcp  open     ssl/http      syn-ack     Apache httpd 2.4.41
| tls-alpn: 
|_  http/1.1
|_http-title: 403 Forbidden
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.41 (Ubuntu)
| ssl-cert: Subject: commonName=grep.thm/organizationName=SearchME/stateOrProvinceName=Some-State/countryName=US
| Issuer: commonName=grep.thm/organizationName=SearchME/stateOrProvinceName=Some-State/countryName=US
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2023-06-14T13:03:09
| Not valid after:  2024-06-13T13:03:09
| MD5:   72958ef07c16221c3b0a40ee913c766c
| SHA-1: 38c23ba334b1851af1d4ee0a37bd701a830c7dd8
| -----BEGIN CERTIFICATE-----
| MIIDFzCCAf8CFGTWwbbVKaNSN8fhUdtf0QT84zCSMA0GCSqGSIb3DQEBCwUAMEgx
| CzAJBgNVBAYTAlVTMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhTZWFy
| Y2hNRTERMA8GA1UEAwwIZ3JlcC50aG0wHhcNMjMwNjE0MTMwMzA5WhcNMjQwNjEz
| MTMwMzA5WjBIMQswCQYDVQQGEwJVUzETMBEGA1UECAwKU29tZS1TdGF0ZTERMA8G
| A1UECgwIU2VhcmNoTUUxETAPBgNVBAMMCGdyZXAudGhtMIIBIjANBgkqhkiG9w0B
| AQEFAAOCAQ8AMIIBCgKCAQEAtiDNwwY9IR2HADMy6CRAwiPH0s8dIOFGPrbYCbLz
| fDKIWURlczzOlmgpscN/YHHpt6P5ywUPLGnMK3ukYag7xTUYl+vmledTnD9oebnJ
| 6qDweFFwdZ8hysITyvCyGgqcY52JE2nBtVNj6/L16iZ60KKko8opNsTE5IYj/sUt
| PsOxeNiV3oqpOUeKtZJbn7Kssd4KBwnRqTSUlXlPXzeRipAiW5SZZXo6K4YeLVht
| XlLPtPWsMC0fj16DDDtxLlZmvu3J5o9egp/eRpWmvKWIaKQ57Y0MKB8/gso8FxxX
| NiRY9Nru0C3DCUbc/xXywQ9pIGt/Xir++aXhyxCiIGh22QIDAQABMA0GCSqGSIb3
| DQEBCwUAA4IBAQCzhJu52dIY7V/qQleDMEQ1oBLrQoFhHD6+UbvH0ELMAtL5Dc8A
| LGDdyFkgsx04TaZtJ20dyrjYD+tcAgu9Yb7eEYbfqqD5w4XSzvdEuTW2aVL86aT6
| IBbN8SMkX2zfILjHTOR1F7WAoHaIssH0yZltg+lQEEnAeb+XoIZm9cIW2bTNKoO2
| MeHgvSKkQkjROO29XQQ3mTbxFG86UsTwyGHdddnkfiWilXqgfh+wGxbY/wCdhU0C
| TnuXn4IEVdCBn16rCg51kEZZC1EWPcJpv0/InUNfcgumcVY033EXF/HgW4eNDD6H
| XmLEGKfScUWcO0//STDZGZXwf9gt30DqoMSf
|_-----END CERTIFICATE-----

</rich_text>
    <rich_text link="webs https://10.10.203.137/">https://10.10.203.137/</rich_text>
    <rich_text>
upon checking the certificate details
about:certificate?cert=MIIDFzCCAf8CFGTWwbbVKaNSN8fhUdtf0QT84zCSMA0GCSqGSIb3DQEBCwUAMEgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApTb21lLVN0YXRlMREwDwYDVQQKDAhTZWFyY2hNRTERMA8GA1UEAwwIZ3JlcC50aG0wHhcNMjMwNjE0MTMwMzA5WhcNMjQwNjEzMTMwMzA5WjBIMQswCQYDVQQGEwJVUzETMBEGA1UECAwKU29tZS1TdGF0ZTERMA8GA1UECgwIU2VhcmNoTUUxETAPBgNVBAMMCGdyZXAudGhtMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtiDNwwY9IR2HADMy6CRAwiPH0s8dIOFGPrbYCbLzfDKIWURlczzOlmgpscN%2FYHHpt6P5ywUPLGnMK3ukYag7xTUYl%2BvmledTnD9oebnJ6qDweFFwdZ8hysITyvCyGgqcY52JE2nBtVNj6%2FL16iZ60KKko8opNsTE5IYj%2FsUtPsOxeNiV3oqpOUeKtZJbn7Kssd4KBwnRqTSUlXlPXzeRipAiW5SZZXo6K4YeLVhtXlLPtPWsMC0fj16DDDtxLlZmvu3J5o9egp%2FeRpWmvKWIaKQ57Y0MKB8%2Fgso8FxxXNiRY9Nru0C3DCUbc%2FxXywQ9pIGt%2FXir%2B%2BaXhyxCiIGh22QIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQCzhJu52dIY7V%2FqQleDMEQ1oBLrQoFhHD6%2BUbvH0ELMAtL5Dc8ALGDdyFkgsx04TaZtJ20dyrjYD%2BtcAgu9Yb7eEYbfqqD5w4XSzvdEuTW2aVL86aT6IBbN8SMkX2zfILjHTOR1F7WAoHaIssH0yZltg%2BlQEEnAeb%2BXoIZm9cIW2bTNKoO2MeHgvSKkQkjROO29XQQ3mTbxFG86UsTwyGHdddnkfiWilXqgfh%2BwGxbY%2FwCdhU0CTnuXn4IEVdCBn16rCg51kEZZC1EWPcJpv0%2FInUNfcgumcVY033EXF%2FHgW4eNDD6HXmLEGKfScUWcO0%2F%2FSTDZGZXwf9gt30DqoMSf

common name - grep.thm
adding 10.10.203.137 grep.thm -&gt; /etc/hosts

adding this to the hosts file will allow us to access the website
we proceed to intercept the registration process using burpsuite
Upon registration we get invalid api or expiry alert box. Indicating that the api key present is just a rabbit hole
e8d25b4208b80008a9e15c8698640e85:johncena			-		the api key is a md5 hash file upon decrypting it we get nothing

referring to google we can find the git hub page </rich_text>
    <rich_text link="webs https://github.com/supersecuredeveloper/searchmecms/commit/db11421db2324ed0991c36493a725bf7db9bdcf6">https://github.com/supersecuredeveloper/searchmecms/commit/db11421db2324ed0991c36493a725bf7db9bdcf6</rich_text>
    <rich_text>		-		which is the actual site
where we can find the necessary api key		-		ffe60ecaa8bba2f12b43d1a4b15b8f39
changing the request we get our registration done

logging into the target
we get out first flag 		-		THM{4ec9806d7e1350270dc402ba870ccebb}

Upon referring to the site structure 		-		</rich_text>
    <rich_text link="webs https://github.com/supersecuredeveloper/searchmecms/blob/main/api/upload.php">https://github.com/supersecuredeveloper/searchmecms/blob/main/api/upload.php</rich_text>
    <rich_text>
we now have a upload vulnerability

</rich_text>
    <rich_text link="webs https://grep.thm/public/html/upload.php">https://grep.thm/public/html/upload.php</rich_text>
    <rich_text>
{"error":"Invalid file type. Only JPG, JPEG, PNG, and BMP files are allowed."}
by changing the magic number of the file with reverse shell generator we can successfully upload the file
{"message":"File uploaded successfully."}

payload.jpg.php
create a listner and activate the script to get a shell
python3 -c ‘import pty;pty.spawn("/bin/bash")’

openssl x509 -in leak_certificate.crt -text -noout      
&lt; openssl x509 -in leak_certificate.crt -text -noout
Certificate:
    Data:
        Version: 1 (0x0)
        Serial Number:
            2c:df:fe:6b:5d:68:11:a2:28:aa:4e:ee:07:6d:a5:d5:46:f6:ee:a2
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C = AU, ST = Some-State, O = Internet Widgits Pty Ltd, CN = leakchecker.grep.thm
        Validity
            Not Before: Jun 14 12:58:31 2023 GMT
            Not After : Jun 13 12:58:31 2024 GMT
        Subject: C = AU, ST = Some-State, O = Internet Widgits Pty Ltd, CN = leakchecker.grep.thm
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:b6:20:cd:c3:06:3d:21:1d:87:00:33:32:e8:24:
                    40:c2:23:c7:d2:cf:1d:20:e1:46:3e:b6:d8:09:b2:
                    f3:7c:32:88:59:44:65:73:3c:ce:96:68:29:b1:c3:
                    7f:60:71:e9:b7:a3:f9:cb:05:0f:2c:69:cc:2b:7b:
                    a4:61:a8:3b:c5:35:18:97:eb:e6:95:e7:53:9c:3f:
                    68:79:b9:c9:ea:a0:f0:78:51:70:75:9f:21:ca:c2:
                    13:ca:f0:b2:1a:0a:9c:63:9d:89:13:69:c1:b5:53:
                    63:eb:f2:f5:ea:26:7a:d0:a2:a4:a3:ca:29:36:c4:
                    c4:e4:86:23:fe:c5:2d:3e:c3:b1:78:d8:95:de:8a:
                    a9:39:47:8a:b5:92:5b:9f:b2:ac:b1:de:0a:07:09:
                    d1:a9:34:94:95:79:4f:5f:37:91:8a:90:22:5b:94:
                    99:65:7a:3a:2b:86:1e:2d:58:6d:5e:52:cf:b4:f5:
                    ac:30:2d:1f:8f:5e:83:0c:3b:71:2e:56:66:be:ed:
                    c9:e6:8f:5e:82:9f:de:46:95:a6:bc:a5:88:68:a4:
                    39:ed:8d:0c:28:1f:3f:82:ca:3c:17:1c:57:36:24:
                    58:f4:da:ee:d0:2d:c3:09:46:dc:ff:15:f2:c1:0f:
                    69:20:6b:7f:5e:2a:fe:f9:a5:e1:cb:10:a2:20:68:
                    76:d9
                Exponent: 65537 (0x10001)
    Signature Algorithm: sha256WithRSAEncryption
         92:25:7c:c9:82:d0:aa:81:3c:6e:ff:e7:86:e4:36:49:c1:0a:
         8f:b3:e9:c9:35:a0:03:a6:1e:aa:e3:20:f5:12:0a:f4:a8:9a:
         03:ff:c2:e5:ee:cc:e9:6c:a6:9f:50:b5:af:21:03:70:cc:f8:
         bd:10:e3:f8:c4:e4:9b:7e:21:75:36:4d:e0:60:bc:5b:19:c7:
         72:09:1a:2a:5f:fc:bc:8e:f0:2d:8c:ce:82:96:5c:ed:c2:c0:
         ff:16:21:11:33:09:c9:1a:49:92:17:b2:b0:4c:8b:15:b3:2a:
         81:a7:2f:19:7f:ce:f6:26:84:cd:34:0b:c6:89:ff:c7:1f:de:
         0b:15:70:5b:62:ba:e7:73:7d:cb:5a:77:b6:b9:83:37:12:18:
         b8:64:01:36:53:72:e1:43:b6:8d:ee:cc:2e:0b:b3:34:97:af:
         c5:a2:14:17:12:19:bc:32:06:46:3d:55:93:9f:a4:df:e4:6e:
         39:b1:64:85:17:a2:f1:7d:07:01:d8:f4:65:9b:0d:ab:ae:02:
         4c:82:0f:87:1a:51:b6:ea:ef:07:5f:4c:51:f4:03:c9:52:c3:
         48:20:ce:fc:ca:86:7f:7e:57:b0:c1:c2:b3:eb:e1:8f:e0:76:
         4a:d4:3f:ac:d6:31:95:a7:3f:26:c8:62:c9:af:6e:8d:9a:2a:
         2f:54:27:ef



1063/tcp filtered kyoceranetdev no-response
Service Info: Host: ip-10-10-203-137.eu-west-1.compute.internal; OS: Linux; CPE: cpe:/o:linux:linux_kernel


gobuster dir -u </rich_text>
    <rich_text link="webs http://10.10.203.137">http://10.10.203.137</rich_text>
    <rich_text> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -z</rich_text>
  </node>
</cherrytree>
